{"version":3,"file":"node-build.mjs","sources":["../../server/db.ts","../../server/models/index.ts","../../server/storage.ts","../../server/jwt.ts","../../server/routes/auth.ts","../../server/routes/admin.ts","../../server/routes/wallet.ts","../../server/twilio.ts","../../server/routes/phone-purchase.ts","../../server/routes/messages.ts","../../server/routes/webhooks.ts","../../server/middleware/auth.ts","../../server/routes/demo.ts","../../server/index.ts","../../server/socket.ts","../../server/node-build.ts"],"sourcesContent":["import mongoose from \"mongoose\";\n\nconst MONGODB_URI = process.env.MONGODB_URI;\n\nlet isConnected = false;\n\nexport async function connectDB() {\n  if (isConnected) {\n    console.log(\"Already connected to MongoDB\");\n    return;\n  }\n\n  try {\n    await mongoose.connect(MONGODB_URI);\n    isConnected = true;\n    console.log(\"Connected to MongoDB successfully\");\n  } catch (error) {\n    console.error(\"Failed to connect to MongoDB:\", error);\n    throw error;\n  }\n}\n\nexport function getDBStatus() {\n  return isConnected;\n}\n\nexport default mongoose;\n","import mongoose, { Schema, Document } from \"mongoose\";\nimport {\n  User,\n  TwilioCredentials,\n  PhoneNumber,\n  TeamMember,\n  Message,\n  Contact,\n  Wallet,\n  WalletTransaction,\n} from \"@shared/api\";\n\n// User Schema\nexport interface IUser extends Document, User {\n  password: string;\n}\n\nconst userSchema = new Schema<IUser>(\n  {\n    email: { type: String, required: true, unique: true, lowercase: true },\n    name: { type: String, required: true },\n    password: { type: String, required: true },\n    role: { type: String, enum: [\"admin\", \"team_member\"], required: true },\n    adminId: { type: String, sparse: true },\n    createdAt: { type: String, required: true },\n  },\n  { collection: \"users\" },\n);\n\nexport const UserModel = mongoose.model<IUser>(\"User\", userSchema);\n\n// Twilio Credentials Schema\nexport interface ITwilioCredentials extends Document, TwilioCredentials {}\n\nconst twilioCredentialsSchema = new Schema<ITwilioCredentials>(\n  {\n    adminId: { type: String, required: true, unique: true },\n    accountSid: { type: String, required: true },\n    authToken: { type: String, required: true },\n    connectedAt: { type: String, required: true },\n  },\n  { collection: \"twilio_credentials\" },\n);\n\nexport const TwilioCredentialsModel = mongoose.model<ITwilioCredentials>(\n  \"TwilioCredentials\",\n  twilioCredentialsSchema,\n);\n\n// Phone Number Schema\nexport interface IPhoneNumber extends Document, PhoneNumber {}\n\nconst phoneNumberSchema = new Schema<IPhoneNumber>(\n  {\n    id: { type: String, required: true, unique: true },\n    adminId: { type: String, required: true },\n    phoneNumber: { type: String, required: true },\n    assignedTo: { type: String, sparse: true },\n    purchasedAt: { type: String, required: true },\n    active: { type: Boolean, default: true },\n  },\n  { collection: \"phone_numbers\" },\n);\n\nexport const PhoneNumberModel = mongoose.model<IPhoneNumber>(\n  \"PhoneNumber\",\n  phoneNumberSchema,\n);\n\n// Team Member Schema\nexport interface ITeamMember extends Document {\n  id: string;\n  email: string;\n  name: string;\n  password: string;\n  adminId: string;\n  status: \"pending\" | \"active\";\n  createdAt: string;\n}\n\nconst teamMemberSchema = new Schema<ITeamMember>(\n  {\n    id: { type: String, required: true, unique: true },\n    email: { type: String, required: true, unique: true, lowercase: true },\n    name: { type: String, required: true },\n    password: { type: String, required: true },\n    adminId: { type: String, required: true },\n    status: { type: String, enum: [\"pending\", \"active\"], default: \"active\" },\n    createdAt: { type: String, required: true },\n  },\n  { collection: \"team_members\" },\n);\n\nexport const TeamMemberModel = mongoose.model<ITeamMember>(\n  \"TeamMember\",\n  teamMemberSchema,\n);\n\n// Message Schema\nexport interface IMessage extends Document, Message {}\n\nconst messageSchema = new Schema<IMessage>(\n  {\n    id: { type: String, required: true, unique: true },\n    phoneNumberId: { type: String, required: true },\n    from: { type: String, required: true },\n    to: { type: String, required: true },\n    body: { type: String, required: true },\n    direction: { type: String, enum: [\"inbound\", \"outbound\"], required: true },\n    timestamp: { type: String, required: true },\n    sid: { type: String, sparse: true },\n  },\n  { collection: \"messages\" },\n);\n\nmessageSchema.index({ phoneNumberId: 1, timestamp: -1 });\n\nexport const MessageModel = mongoose.model<IMessage>(\"Message\", messageSchema);\n\n// Contact Schema\nexport interface IContact extends Document, Contact {}\n\nconst contactSchema = new Schema<IContact>(\n  {\n    id: { type: String, required: true, unique: true },\n    phoneNumberId: { type: String, required: true },\n    phoneNumber: { type: String, required: true },\n    name: { type: String, sparse: true },\n    lastMessage: { type: String, sparse: true },\n    lastMessageTime: { type: String, sparse: true },\n    unreadCount: { type: Number, default: 0 },\n  },\n  { collection: \"contacts\" },\n);\n\ncontactSchema.index({ phoneNumberId: 1 });\n\nexport const ContactModel = mongoose.model<IContact>(\"Contact\", contactSchema);\n\n// Wallet Schema\nexport interface IWallet extends Document, Wallet {}\n\nconst walletSchema = new Schema<IWallet>(\n  {\n    adminId: { type: String, required: true, unique: true },\n    balance: { type: Number, required: true, default: 0 },\n    currency: { type: String, required: true, default: \"USD\" },\n    createdAt: { type: String, required: true },\n    updatedAt: { type: String, required: true },\n  },\n  { collection: \"wallets\" },\n);\n\nexport const WalletModel = mongoose.model<IWallet>(\"Wallet\", walletSchema);\n\n// Wallet Transaction Schema\nexport interface IWalletTransaction extends Document, WalletTransaction {}\n\nconst walletTransactionSchema = new Schema<IWalletTransaction>(\n  {\n    adminId: { type: String, required: true },\n    type: { type: String, enum: [\"credit\", \"debit\"], required: true },\n    amount: { type: Number, required: true },\n    description: { type: String, required: true },\n    reference: { type: String, sparse: true },\n    createdAt: { type: String, required: true },\n  },\n  { collection: \"wallet_transactions\" },\n);\n\nwalletTransactionSchema.index({ adminId: 1, createdAt: -1 });\n\nexport const WalletTransactionModel = mongoose.model<IWalletTransaction>(\n  \"WalletTransaction\",\n  walletTransactionSchema,\n);\n","/**\n * MongoDB-backed storage layer\n * Provides persistent data storage using MongoDB\n */\nimport {\n  UserModel,\n  TwilioCredentialsModel,\n  PhoneNumberModel,\n  TeamMemberModel,\n  MessageModel,\n  ContactModel,\n  WalletModel,\n  WalletTransactionModel,\n} from \"./models\";\nimport {\n  User,\n  TwilioCredentials,\n  PhoneNumber,\n  TeamMember,\n  Message,\n  Contact,\n  Wallet,\n  WalletTransaction,\n} from \"@shared/api\";\n\nclass Storage {\n  // User operations\n  async createUser(user: User & { password: string }): Promise<void> {\n    const newUser = new UserModel(user);\n    await newUser.save();\n  }\n\n  async getUserByEmail(\n    email: string,\n  ): Promise<(User & { password: string }) | undefined> {\n    return (await UserModel.findOne({ email: email.toLowerCase() })) as\n      | (User & { password: string })\n      | null;\n  }\n\n  async getUserById(id: string): Promise<User | undefined> {\n    const user = (await UserModel.findById(id)) as any;\n    if (!user) return undefined;\n    const { password, ...userWithoutPassword } = user.toObject();\n    return userWithoutPassword as User;\n  }\n\n  // Twilio Credentials\n  async setTwilioCredentials(credentials: TwilioCredentials): Promise<void> {\n    await TwilioCredentialsModel.updateOne(\n      { adminId: credentials.adminId },\n      credentials,\n      { upsert: true },\n    );\n  }\n\n  async getTwilioCredentialsByAdminId(\n    adminId: string,\n  ): Promise<TwilioCredentials | undefined> {\n    return (await TwilioCredentialsModel.findOne({\n      adminId,\n    })) as TwilioCredentials | null;\n  }\n\n  async removeTwilioCredentials(adminId: string): Promise<void> {\n    await TwilioCredentialsModel.deleteOne({ adminId });\n  }\n\n  // Phone Numbers\n  async addPhoneNumber(number: PhoneNumber): Promise<void> {\n    const newNumber = new PhoneNumberModel(number);\n    await newNumber.save();\n  }\n\n  async getPhoneNumbersByAdminId(adminId: string): Promise<PhoneNumber[]> {\n    const numbers = await PhoneNumberModel.find({ adminId });\n    return numbers.map((doc: any) => {\n      const data = doc.toObject();\n      // If id is missing, use MongoDB's _id as fallback\n      if (!data.id && data._id) {\n        data.id = data._id.toString();\n      }\n      return data as PhoneNumber;\n    });\n  }\n\n  async getPhoneNumberById(id: string): Promise<PhoneNumber | undefined> {\n    const doc = await PhoneNumberModel.findOne({ $or: [{ id }, { _id: id }] });\n    if (!doc) return undefined;\n    const data = doc.toObject() as any;\n    if (!data.id && data._id) {\n      data.id = data._id.toString();\n    }\n    return data as PhoneNumber;\n  }\n\n  async getPhoneNumberByPhoneNumber(\n    phoneNumber: string,\n  ): Promise<PhoneNumber | undefined> {\n    const doc = await PhoneNumberModel.findOne({ phoneNumber });\n    if (!doc) return undefined;\n    const data = doc.toObject() as any;\n    if (!data.id && data._id) {\n      data.id = data._id.toString();\n    }\n    return data as PhoneNumber;\n  }\n\n  async updatePhoneNumber(number: PhoneNumber): Promise<void> {\n    await PhoneNumberModel.findOneAndUpdate({ id: number.id }, number, {\n      new: true,\n    });\n  }\n\n  // Team Members\n  async addTeamMember(\n    member: TeamMember & { password: string },\n  ): Promise<void> {\n    const newMember = new TeamMemberModel(member);\n    await newMember.save();\n  }\n\n  async getTeamMembersByAdminId(adminId: string): Promise<TeamMember[]> {\n    const members = await TeamMemberModel.find({ adminId });\n    return members.map((member) => {\n      const { password, ...teamMember } = member.toObject() as any;\n      return teamMember as TeamMember;\n    });\n  }\n\n  async getTeamMemberById(id: string): Promise<TeamMember | undefined> {\n    const member = await TeamMemberModel.findOne({ id });\n    if (!member) return undefined;\n    const { password, ...memberWithoutPassword } = member.toObject() as any;\n    return memberWithoutPassword as TeamMember;\n  }\n\n  async getAdminIdByTeamMemberId(\n    teamMemberId: string,\n  ): Promise<string | undefined> {\n    const member = await TeamMemberModel.findOne({ id: teamMemberId });\n    return member?.adminId;\n  }\n\n  async removeTeamMember(memberId: string): Promise<void> {\n    await UserModel.deleteOne({ id: memberId, role: \"team_member\" });\n    await TeamMemberModel.deleteOne({ id: memberId });\n  }\n\n  // Messages\n  async addMessage(message: Message): Promise<void> {\n    const newMessage = new MessageModel(message);\n    await newMessage.save();\n  }\n\n  async getMessagesByPhoneNumber(phoneNumberId: string): Promise<Message[]> {\n    const messages = await MessageModel.find({ phoneNumberId }).sort({\n      timestamp: 1,\n    });\n    return messages.map((doc: any) => {\n      const data = doc.toObject();\n      if (!data.id && data._id) {\n        data.id = data._id.toString();\n      }\n      return data as Message;\n    });\n  }\n\n  // Contacts\n  async addContact(contact: Contact): Promise<void> {\n    const newContact = new ContactModel(contact);\n    await newContact.save();\n  }\n\n  async getContactsByPhoneNumber(phoneNumberId: string): Promise<Contact[]> {\n    const contacts = await ContactModel.find({ phoneNumberId });\n    return contacts.map((doc: any) => {\n      const data = doc.toObject();\n      if (!data.id && data._id) {\n        data.id = data._id.toString();\n      }\n      return data as Contact;\n    });\n  }\n\n  async getContactById(id: string): Promise<Contact | undefined> {\n    // Try to find by custom id field first\n    let doc = await ContactModel.findOne({ id });\n\n    // If not found by custom id, try MongoDB's _id as fallback (only if it's a valid ObjectId)\n    if (!doc && /^[0-9a-f]{24}$/i.test(id)) {\n      try {\n        doc = await ContactModel.findById(id);\n      } catch (error) {\n        // findById will throw if id is not a valid ObjectId, ignore it\n      }\n    }\n\n    if (!doc) return undefined;\n\n    const data = doc.toObject() as any;\n    if (!data.id) {\n      if (data._id) {\n        data.id = data._id.toString();\n      } else {\n        console.warn(\"Contact has no ID field:\", data);\n      }\n    }\n    return data as Contact;\n  }\n\n  async updateContact(contact: Contact): Promise<void> {\n    await ContactModel.findOneAndUpdate({ id: contact.id }, contact, {\n      new: true,\n    });\n  }\n\n  async deleteContact(id: string): Promise<void> {\n    await ContactModel.deleteOne({ id });\n  }\n\n  // Wallet operations\n  async getOrCreateWallet(adminId: string): Promise<Wallet> {\n    let wallet = (await WalletModel.findOne({ adminId })) as Wallet | null;\n    if (!wallet) {\n      const newWallet = new WalletModel({\n        adminId,\n        balance: 0,\n        currency: \"USD\",\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n      });\n      wallet = (await newWallet.save()) as Wallet;\n    }\n    return wallet;\n  }\n\n  async getWallet(adminId: string): Promise<Wallet | undefined> {\n    return (await WalletModel.findOne({ adminId })) as Wallet | null;\n  }\n\n  async updateWalletBalance(\n    adminId: string,\n    newBalance: number,\n  ): Promise<void> {\n    await WalletModel.updateOne(\n      { adminId },\n      {\n        balance: newBalance,\n        updatedAt: new Date().toISOString(),\n      },\n      { upsert: true },\n    );\n  }\n\n  async addWalletTransaction(transaction: WalletTransaction): Promise<void> {\n    const newTransaction = new WalletTransactionModel(transaction);\n    await newTransaction.save();\n  }\n\n  async getWalletTransactions(\n    adminId: string,\n    limit: number = 50,\n  ): Promise<WalletTransaction[]> {\n    return (await WalletTransactionModel.find({ adminId })\n      .sort({ createdAt: -1 })\n      .limit(limit)) as WalletTransaction[];\n  }\n\n  // Utility\n  generateId(): string {\n    return Math.random().toString(36).substr(2, 9);\n  }\n}\n\nexport const storage = new Storage();\n","import crypto from \"crypto\";\n\nconst JWT_SECRET =\n  process.env.JWT_SECRET || \"your-secret-key-change-in-production\";\n\ninterface JWTPayload {\n  userId: string;\n  email: string;\n  role: \"admin\" | \"team_member\";\n  iat: number;\n  exp: number;\n}\n\nfunction base64UrlEncode(str: string): string {\n  return Buffer.from(str)\n    .toString(\"base64\")\n    .replace(/\\+/g, \"-\")\n    .replace(/\\//g, \"_\")\n    .replace(/=/g, \"\");\n}\n\nfunction base64UrlDecode(str: string): string {\n  str += new Array(5 - (str.length % 4)).join(\"=\");\n  return Buffer.from(\n    str.replace(/-/g, \"+\").replace(/_/g, \"/\"),\n    \"base64\",\n  ).toString();\n}\n\nexport function generateToken(\n  payload: Omit<JWTPayload, \"iat\" | \"exp\">,\n): string {\n  const now = Math.floor(Date.now() / 1000);\n  const jwtPayload: JWTPayload = {\n    ...payload,\n    iat: now,\n    exp: now + 24 * 60 * 60, // 24 hours\n  };\n\n  const header = base64UrlEncode(JSON.stringify({ alg: \"HS256\", typ: \"JWT\" }));\n  const payload64 = base64UrlEncode(JSON.stringify(jwtPayload));\n\n  const signature = crypto\n    .createHmac(\"sha256\", JWT_SECRET)\n    .update(`${header}.${payload64}`)\n    .digest();\n  const signature64 = base64UrlEncode(signature.toString(\"base64\"));\n\n  return `${header}.${payload64}.${signature64}`;\n}\n\nexport function verifyToken(token: string): JWTPayload | null {\n  try {\n    const parts = token.split(\".\");\n    if (parts.length !== 3) return null;\n\n    const [header64, payload64, signature64] = parts;\n\n    // Verify signature\n    const signature = crypto\n      .createHmac(\"sha256\", JWT_SECRET)\n      .update(`${header64}.${payload64}`)\n      .digest();\n    const expectedSignature = base64UrlEncode(signature.toString(\"base64\"));\n\n    if (signature64 !== expectedSignature) return null;\n\n    // Parse payload\n    const payload = JSON.parse(base64UrlDecode(payload64)) as JWTPayload;\n\n    // Check expiration\n    if (payload.exp < Math.floor(Date.now() / 1000)) return null;\n\n    return payload;\n  } catch {\n    return null;\n  }\n}\n\nexport function extractTokenFromHeader(authHeader?: string): string | null {\n  if (!authHeader) return null;\n  const parts = authHeader.split(\" \");\n  if (parts.length !== 2 || parts[0] !== \"Bearer\") return null;\n  return parts[1];\n}\n","import { RequestHandler } from \"express\";\nimport crypto from \"crypto\";\nimport { storage } from \"../storage\";\nimport { generateToken } from \"../jwt\";\nimport { SignupRequest, LoginRequest, AuthResponse, User } from \"@shared/api\";\n\nfunction hashPassword(password: string): string {\n  return crypto.createHash(\"sha256\").update(password).digest(\"hex\");\n}\n\nfunction verifyPassword(password: string, hash: string): boolean {\n  return hashPassword(password) === hash;\n}\n\nexport const handleSignup: RequestHandler = async (req, res) => {\n  try {\n    const { email, password, name } = req.body as SignupRequest;\n\n    // Validation\n    if (!email || !password || !name) {\n      return res.status(400).json({ error: \"Missing required fields\" });\n    }\n\n    // Check if user exists\n    const existingUser = await storage.getUserByEmail(email);\n    if (existingUser) {\n      return res.status(400).json({ error: \"User already exists\" });\n    }\n\n    const userId = storage.generateId();\n    const hashedPassword = hashPassword(password);\n\n    // Create user as admin\n    const user: User & { password: string } = {\n      id: userId,\n      email,\n      name,\n      password: hashedPassword,\n      role: \"admin\",\n      createdAt: new Date().toISOString(),\n    };\n\n    await storage.createUser(user);\n\n    const token = generateToken({\n      userId,\n      email,\n      role: \"admin\",\n    });\n\n    const userResponse: User = {\n      id: userId,\n      email,\n      name,\n      role: \"admin\",\n      createdAt: user.createdAt,\n    };\n\n    const response: AuthResponse = {\n      user: userResponse,\n      token,\n    };\n\n    res.json(response);\n  } catch (error) {\n    console.error(\"Signup error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleLogin: RequestHandler = async (req, res) => {\n  try {\n    const { email, password } = req.body as LoginRequest;\n\n    // Validation\n    if (!email || !password) {\n      return res.status(400).json({ error: \"Missing required fields\" });\n    }\n\n    // Find user\n    const user = await storage.getUserByEmail(email);\n    if (!user) {\n      return res.status(401).json({ error: \"Invalid credentials\" });\n    }\n\n    // Verify password\n    if (!verifyPassword(password, user.password)) {\n      return res.status(401).json({ error: \"Invalid credentials\" });\n    }\n\n    const token = generateToken({\n      userId: user.id,\n      email: user.email,\n      role: user.role,\n    });\n\n    const userResponse: User = {\n      id: user.id,\n      email: user.email,\n      name: user.name,\n      role: user.role,\n      adminId: user.adminId,\n      createdAt: user.createdAt,\n    };\n\n    const response: AuthResponse = {\n      user: userResponse,\n      token,\n    };\n\n    res.json(response);\n  } catch (error) {\n    console.error(\"Login error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleVerifySession: RequestHandler = async (req, res) => {\n  try {\n    const user = req.user;\n\n    if (!user) {\n      return res.status(401).json({\n        error: \"Session invalid\",\n        valid: false,\n      });\n    }\n\n    res.json({\n      valid: true,\n      user,\n    });\n  } catch (error) {\n    console.error(\"Session verification error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleGetProfile: RequestHandler = async (req, res) => {\n  try {\n    const userId = req.userId!;\n    const user = await storage.getUserById(userId);\n\n    if (!user) {\n      return res.status(404).json({ error: \"User not found\" });\n    }\n\n    res.json({ user });\n  } catch (error) {\n    console.error(\"Get profile error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n","import { RequestHandler } from \"express\";\nimport crypto from \"crypto\";\nimport https from \"https\";\nimport { storage } from \"../storage\";\nimport { generateToken } from \"../jwt\";\nimport {\n  TwilioCredentialsRequest,\n  TwilioCredentials,\n  PhoneNumber,\n  TeamMember,\n  User,\n} from \"@shared/api\";\n\nfunction hashPassword(password: string): string {\n  return crypto.createHash(\"sha256\").update(password).digest(\"hex\");\n}\n\n// Validate Twilio credentials by making a test API call\nasync function validateTwilioCredentials(\n  accountSid: string,\n  authToken: string,\n): Promise<{ valid: boolean; error?: string }> {\n  return new Promise((resolve) => {\n    try {\n      // Validate format first\n      if (!accountSid.startsWith(\"AC\") || accountSid.length !== 34) {\n        return resolve({\n          valid: false,\n          error:\n            \"Invalid Account SID format (should start with AC and be 34 characters)\",\n        });\n      }\n\n      if (authToken.length < 32) {\n        return resolve({\n          valid: false,\n          error: \"Invalid Auth Token format (should be at least 32 characters)\",\n        });\n      }\n\n      // Make a test API call to Twilio\n      const auth = Buffer.from(`${accountSid}:${authToken}`).toString(\"base64\");\n\n      const options = {\n        hostname: \"api.twilio.com\",\n        path: `/2010-04-01/Accounts/${accountSid}/Calls.json?PageSize=1`,\n        method: \"GET\",\n        headers: {\n          Authorization: `Basic ${auth}`,\n        },\n      };\n\n      const req = https.request(options, (res) => {\n        // If we get 401, credentials are invalid\n        if (res.statusCode === 401) {\n          return resolve({\n            valid: false,\n            error:\n              \"Invalid Twilio credentials (401 Unauthorized). Please check your Account SID and Auth Token.\",\n          });\n        }\n\n        // If we get 403, account might be suspended\n        if (res.statusCode === 403) {\n          return resolve({\n            valid: false,\n            error:\n              \"Access forbidden (403). Your Twilio account may be suspended or restricted.\",\n          });\n        }\n\n        // If we get 200 or 429 (rate limited), credentials are valid\n        if (res.statusCode === 200 || res.statusCode === 429) {\n          return resolve({ valid: true });\n        }\n\n        // Any other status code might indicate an issue\n        if (res.statusCode && res.statusCode >= 500) {\n          return resolve({\n            valid: false,\n            error: \"Twilio API error. Please try again later.\",\n          });\n        }\n\n        return resolve({ valid: true });\n      });\n\n      req.on(\"error\", (error) => {\n        console.error(\"Twilio validation error:\", error);\n        return resolve({\n          valid: false,\n          error:\n            \"Failed to connect to Twilio API. Please check your internet connection.\",\n        });\n      });\n\n      req.end();\n    } catch (error) {\n      console.error(\"Credential validation error:\", error);\n      return resolve({\n        valid: false,\n        error: \"Failed to validate credentials\",\n      });\n    }\n  });\n}\n\n// Twilio Credentials\nexport const handleSaveCredentials: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const { accountSid, authToken } = req.body as TwilioCredentialsRequest;\n\n    if (!accountSid || !authToken) {\n      return res\n        .status(400)\n        .json({ error: \"Please enter both Account SID and Auth Token\" });\n    }\n\n    // Validate credentials format and connectivity\n    const validation = await validateTwilioCredentials(accountSid, authToken);\n    if (!validation.valid) {\n      return res.status(400).json({ error: validation.error });\n    }\n\n    const credentialsId = storage.generateId();\n    const credentials: TwilioCredentials = {\n      id: credentialsId,\n      adminId,\n      accountSid,\n      authToken,\n      connectedAt: new Date().toISOString(),\n    };\n\n    storage.setTwilioCredentials(credentials);\n    res.json({ credentials });\n  } catch (error) {\n    console.error(\"Save credentials error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleGetCredentials: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const credentials = await storage.getTwilioCredentialsByAdminId(adminId);\n\n    if (!credentials) {\n      return res.json({ credentials: null });\n    }\n\n    res.json({ credentials });\n  } catch (error) {\n    console.error(\"Get credentials error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleRemoveCredentials: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    await storage.removeTwilioCredentials(adminId);\n    res.json({ success: true });\n  } catch (error) {\n    console.error(\"Remove credentials error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\n// Phone Numbers\nexport const handleGetNumbers: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const numbers = await storage.getPhoneNumbersByAdminId(adminId);\n    res.json({ numbers });\n  } catch (error) {\n    console.error(\"Get numbers error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleSetActiveNumber: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const { phoneNumberId } = req.body;\n\n    if (!phoneNumberId) {\n      return res.status(400).json({ error: \"Phone number ID is required\" });\n    }\n\n    // Get the phone number and verify it belongs to this admin\n    const numbers = await storage.getPhoneNumbersByAdminId(adminId);\n    const phoneNumber = numbers.find((n) => n.id === phoneNumberId);\n\n    if (!phoneNumber) {\n      return res.status(404).json({ error: \"Phone number not found\" });\n    }\n\n    // Update all numbers to set active: false, then set the selected one to true\n    for (const number of numbers) {\n      await storage.updatePhoneNumber({\n        ...number,\n        active: number.id === phoneNumberId,\n      });\n    }\n\n    res.json({ number: { ...phoneNumber, active: true } });\n  } catch (error) {\n    console.error(\"Set active number error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\n// Team Management\nexport const handleGetTeamMembers: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const members = await storage.getTeamMembersByAdminId(adminId);\n    res.json({ members });\n  } catch (error) {\n    console.error(\"Get team members error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleInviteTeamMember: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const { email, name, password } = req.body;\n\n    if (!email || !name || !password) {\n      return res.status(400).json({ error: \"Missing required fields\" });\n    }\n\n    // Check if this admin already has a team member with this email\n    const existingTeamMembers = await storage.getTeamMembersByAdminId(adminId);\n    if (\n      existingTeamMembers.some(\n        (member) => member.email.toLowerCase() === email.toLowerCase(),\n      )\n    ) {\n      return res\n        .status(400)\n        .json({ error: \"This team member already exists in your team\" });\n    }\n\n    const userId = storage.generateId();\n    const hashedPassword = hashPassword(password);\n\n    // Create user as team member\n    const user: User & { password: string } = {\n      id: userId,\n      email,\n      name,\n      password: hashedPassword,\n      role: \"team_member\",\n      adminId,\n      createdAt: new Date().toISOString(),\n    };\n\n    await storage.createUser(user);\n\n    // Create team member record\n    const teamMember: TeamMember & { password: string } = {\n      id: userId,\n      email,\n      name,\n      password: hashedPassword,\n      adminId,\n      status: \"active\",\n      createdAt: new Date().toISOString(),\n    };\n\n    await storage.addTeamMember(teamMember);\n\n    const userResponse: User = {\n      id: userId,\n      email,\n      name,\n      role: \"team_member\",\n      adminId,\n      createdAt: user.createdAt,\n    };\n\n    res.json({ user: userResponse });\n  } catch (error) {\n    console.error(\"Invite team member error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleRemoveTeamMember: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const { memberId } = req.params;\n\n    if (!memberId) {\n      return res.status(400).json({ error: \"Member ID is required\" });\n    }\n\n    // Verify the member belongs to this admin\n    const member = await storage.getTeamMemberById(memberId);\n    if (!member || member.adminId !== adminId) {\n      return res.status(403).json({ error: \"Unauthorized\" });\n    }\n\n    // Remove from both UserModel and TeamMemberModel\n    await storage.removeTeamMember(memberId);\n\n    res.json({ success: true });\n  } catch (error) {\n    console.error(\"Remove team member error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\n// Add existing phone number to account\nexport const handleAddExistingNumber: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const { phoneNumber } = req.body as { phoneNumber: string };\n\n    if (!phoneNumber) {\n      return res.status(400).json({ error: \"Phone number is required\" });\n    }\n\n    // Validate phone number format (basic validation)\n    const cleanNumber = phoneNumber.replace(/\\D/g, \"\");\n    if (cleanNumber.length < 10) {\n      return res.status(400).json({\n        error: \"Invalid phone number format\",\n      });\n    }\n\n    // Check if number already exists\n    const existingNumbers = await storage.getPhoneNumbersByAdminId(adminId);\n    if (existingNumbers.some((n) => n.phoneNumber === phoneNumber)) {\n      return res.status(400).json({\n        error: \"This number is already in your account\",\n      });\n    }\n\n    // Add the phone number\n    const newPhoneNumber: PhoneNumber = {\n      id: storage.generateId(),\n      adminId,\n      phoneNumber,\n      purchasedAt: new Date().toISOString(),\n      active: true,\n    };\n\n    await storage.addPhoneNumber(newPhoneNumber);\n\n    res.json({ phoneNumber: newPhoneNumber });\n  } catch (error) {\n    console.error(\"Add existing number error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\n// Assign phone number to team member\nexport const handleAssignNumber: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const { phoneNumberId, teamMemberId } = req.body;\n\n    if (!phoneNumberId) {\n      return res.status(400).json({ error: \"Phone number ID is required\" });\n    }\n\n    // Get the phone number and verify it belongs to this admin\n    const numbers = await storage.getPhoneNumbersByAdminId(adminId);\n    const phoneNumber = numbers.find((n) => n.id === phoneNumberId);\n\n    if (!phoneNumber) {\n      return res.status(404).json({ error: \"Phone number not found\" });\n    }\n\n    // If assigning to a team member, verify they exist and belong to this admin\n    if (teamMemberId) {\n      const members = await storage.getTeamMembersByAdminId(adminId);\n      const member = members.find((m) => m.id === teamMemberId);\n\n      if (!member) {\n        return res.status(404).json({ error: \"Team member not found\" });\n      }\n    }\n\n    // Update the phone number with assignment\n    const updatedNumber: PhoneNumber = {\n      ...phoneNumber,\n      assignedTo: teamMemberId,\n    };\n\n    await storage.updatePhoneNumber(updatedNumber);\n\n    res.json({ phoneNumber: updatedNumber });\n  } catch (error) {\n    console.error(\"Assign number error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\n// Update phone number settings (active/inactive)\nexport const handleUpdateNumberSettings: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const { phoneNumberId, active } = req.body;\n\n    if (!phoneNumberId) {\n      return res.status(400).json({ error: \"Phone number ID is required\" });\n    }\n\n    if (typeof active !== \"boolean\") {\n      return res.status(400).json({ error: \"Active status is required\" });\n    }\n\n    // Get the phone number and verify it belongs to this admin\n    const numbers = await storage.getPhoneNumbersByAdminId(adminId);\n    const phoneNumber = numbers.find((n) => n.id === phoneNumberId);\n\n    if (!phoneNumber) {\n      return res.status(404).json({ error: \"Phone number not found\" });\n    }\n\n    // Update the phone number settings\n    const updatedNumber: PhoneNumber = {\n      ...phoneNumber,\n      active,\n    };\n\n    await storage.updatePhoneNumber(updatedNumber);\n\n    res.json({ phoneNumber: updatedNumber });\n  } catch (error) {\n    console.error(\"Update number settings error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\n// Dashboard Statistics\nexport const handleGetDashboardStats: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n\n    const [numbers, teamMembers] = await Promise.all([\n      storage.getPhoneNumbersByAdminId(adminId),\n      storage.getTeamMembersByAdminId(adminId),\n    ]);\n\n    const activeNumbers = numbers.filter((n) => n.active).length;\n\n    res.json({\n      stats: {\n        activeNumbers,\n        teamMembersCount: teamMembers.length,\n        teamMembers: teamMembers.map((member) => ({\n          id: member.id,\n          name: member.name,\n          email: member.email,\n          createdAt: member.createdAt,\n          status: member.status,\n        })),\n      },\n    });\n  } catch (error) {\n    console.error(\"Get dashboard stats error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n","import { RequestHandler } from \"express\";\nimport { storage } from \"../storage\";\nimport { Wallet, WalletTransaction } from \"@shared/api\";\n\nexport const handleGetWallet: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const wallet = await storage.getOrCreateWallet(adminId);\n    res.json({ wallet });\n  } catch (error) {\n    console.error(\"Get wallet error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleAddFunds: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const { amount } = req.body as { amount: number };\n\n    if (!amount || amount <= 0) {\n      return res.status(400).json({ error: \"Invalid amount\" });\n    }\n\n    const wallet = await storage.getOrCreateWallet(adminId);\n    const newBalance = wallet.balance + amount;\n\n    await storage.updateWalletBalance(adminId, newBalance);\n\n    const transaction: WalletTransaction = {\n      id: storage.generateId(),\n      adminId,\n      type: \"credit\",\n      amount,\n      description: \"Wallet fund added\",\n      createdAt: new Date().toISOString(),\n    };\n\n    await storage.addWalletTransaction(transaction);\n\n    const updatedWallet = await storage.getWallet(adminId);\n    res.json({ wallet: updatedWallet });\n  } catch (error) {\n    console.error(\"Add funds error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleGetTransactions: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const transactions = await storage.getWalletTransactions(adminId);\n    res.json({ transactions });\n  } catch (error) {\n    console.error(\"Get transactions error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n","/**\n * Twilio integration utility\n * This will handle SMS sending and receiving through Twilio API\n */\nimport https from \"https\";\n\ninterface TwilioSMSRequest {\n  To: string;\n  From: string;\n  Body: string;\n}\n\ninterface TwilioResponse {\n  sid?: string;\n  error?: string;\n  error_message?: string;\n}\n\nexport class TwilioClient {\n  private accountSid: string;\n  private authToken: string;\n\n  constructor(accountSid: string, authToken: string) {\n    this.accountSid = accountSid;\n    this.authToken = authToken;\n  }\n\n  /**\n   * Send an SMS message through Twilio\n   */\n  async sendSMS(\n    to: string,\n    from: string,\n    body: string,\n  ): Promise<TwilioResponse> {\n    return new Promise((resolve, reject) => {\n      const auth = Buffer.from(`${this.accountSid}:${this.authToken}`).toString(\n        \"base64\",\n      );\n\n      const postData = new URLSearchParams({\n        To: to,\n        From: from,\n        Body: body,\n      }).toString();\n\n      const options = {\n        hostname: \"api.twilio.com\",\n        path: `/2010-04-01/Accounts/${this.accountSid}/Messages.json`,\n        method: \"POST\",\n        headers: {\n          Authorization: `Basic ${auth}`,\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n          \"Content-Length\": Buffer.byteLength(postData),\n        },\n      };\n\n      const req = https.request(options, (res) => {\n        let data = \"\";\n\n        res.on(\"data\", (chunk) => {\n          data += chunk;\n        });\n\n        res.on(\"end\", () => {\n          try {\n            const response = JSON.parse(data);\n            resolve(response);\n          } catch (error) {\n            reject(error);\n          }\n        });\n      });\n\n      req.on(\"error\", (error) => {\n        reject(error);\n      });\n\n      req.write(postData);\n      req.end();\n    });\n  }\n\n  /**\n   * Get available phone numbers from Twilio\n   * @param countryCode - ISO country code (US, CA, GB, AU, etc)\n   * @param areaCodeIndex - Which area code to use (0, 1, 2, etc) for fallback\n   * @param state - State/region code (e.g., CA, NY, BC, ON)\n   */\n  async getAvailableNumbers(\n    countryCode: string = \"US\",\n    areaCodeIndex: number = 0,\n    state?: string,\n  ): Promise<any> {\n    return new Promise((resolve, reject) => {\n      const auth = Buffer.from(`${this.accountSid}:${this.authToken}`).toString(\n        \"base64\",\n      );\n\n      // State to area code mappings\n      const US_STATE_AREA_CODES: Record<string, string[]> = {\n        AL: [\"205\", \"251\", \"334\"],\n        AK: [\"907\"],\n        AZ: [\"480\", \"602\", \"623\", \"928\"],\n        AR: [\"479\", \"501\", \"870\"],\n        CA: [\n          \"209\",\n          \"213\",\n          \"310\",\n          \"323\",\n          \"408\",\n          \"415\",\n          \"510\",\n          \"530\",\n          \"559\",\n          \"619\",\n          \"626\",\n          \"650\",\n          \"661\",\n          \"707\",\n          \"714\",\n          \"760\",\n          \"805\",\n          \"818\",\n          \"831\",\n          \"858\",\n          \"916\",\n          \"925\",\n          \"949\",\n        ],\n        CO: [\"303\", \"719\", \"720\", \"970\"],\n        CT: [\"203\", \"475\", \"860\"],\n        DE: [\"302\"],\n        FL: [\n          \"239\",\n          \"305\",\n          \"321\",\n          \"352\",\n          \"386\",\n          \"407\",\n          \"561\",\n          \"727\",\n          \"772\",\n          \"813\",\n          \"850\",\n          \"863\",\n          \"904\",\n          \"941\",\n        ],\n        GA: [\"229\", \"404\", \"470\", \"478\", \"678\", \"706\", \"770\", \"912\"],\n        HI: [\"808\"],\n        ID: [\"208\"],\n        IL: [\n          \"217\",\n          \"224\",\n          \"309\",\n          \"312\",\n          \"331\",\n          \"618\",\n          \"630\",\n          \"708\",\n          \"773\",\n          \"815\",\n        ],\n        IN: [\"219\", \"260\", \"317\", \"463\", \"574\", \"765\", \"812\", \"930\"],\n        IA: [\"319\", \"515\", \"563\", \"641\", \"712\"],\n        KS: [\"316\", \"620\", \"785\", \"913\"],\n        KY: [\"270\", \"364\", \"502\", \"606\", \"859\"],\n        LA: [\"225\", \"318\", \"337\", \"504\", \"985\"],\n        ME: [\"207\"],\n        MD: [\"240\", \"301\", \"410\", \"667\"],\n        MA: [\"339\", \"351\", \"413\", \"508\", \"617\", \"774\", \"781\", \"857\"],\n        MI: [\n          \"231\",\n          \"248\",\n          \"269\",\n          \"313\",\n          \"517\",\n          \"586\",\n          \"616\",\n          \"734\",\n          \"810\",\n          \"906\",\n          \"989\",\n        ],\n        MN: [\"218\", \"320\", \"507\", \"612\", \"651\", \"763\", \"952\"],\n        MS: [\"228\", \"601\", \"662\"],\n        MO: [\"314\", \"417\", \"573\", \"636\", \"660\", \"816\", \"975\"],\n        MT: [\"406\"],\n        NE: [\"308\", \"402\", \"531\"],\n        NV: [\"702\", \"725\", \"775\"],\n        NH: [\"603\"],\n        NJ: [\"201\", \"609\", \"732\", \"856\", \"908\", \"973\"],\n        NM: [\"505\", \"575\"],\n        NY: [\n          \"212\",\n          \"315\",\n          \"347\",\n          \"516\",\n          \"518\",\n          \"585\",\n          \"607\",\n          \"631\",\n          \"716\",\n          \"718\",\n          \"845\",\n          \"914\",\n        ],\n        NC: [\"252\", \"336\", \"704\", \"828\", \"910\", \"919\", \"980\"],\n        ND: [\"701\"],\n        OH: [\n          \"216\",\n          \"220\",\n          \"330\",\n          \"380\",\n          \"419\",\n          \"440\",\n          \"513\",\n          \"567\",\n          \"614\",\n          \"740\",\n          \"937\",\n        ],\n        OK: [\"405\", \"539\", \"580\", \"918\"],\n        OR: [\"503\", \"541\", \"971\"],\n        PA: [\"215\", \"267\", \"412\", \"484\", \"570\", \"610\", \"717\", \"724\", \"814\"],\n        RI: [\"401\"],\n        SC: [\"803\", \"843\", \"864\"],\n        SD: [\"605\"],\n        TN: [\"423\", \"615\", \"731\", \"865\"],\n        TX: [\n          \"210\",\n          \"214\",\n          \"254\",\n          \"281\",\n          \"325\",\n          \"361\",\n          \"409\",\n          \"430\",\n          \"432\",\n          \"469\",\n          \"512\",\n          \"620\",\n          \"682\",\n          \"713\",\n          \"737\",\n          \"806\",\n          \"817\",\n          \"830\",\n          \"903\",\n          \"915\",\n          \"936\",\n          \"940\",\n          \"956\",\n          \"972\",\n          \"979\",\n        ],\n        UT: [\"385\", \"435\", \"801\"],\n        VT: [\"802\"],\n        VA: [\"276\", \"434\", \"540\", \"571\", \"703\", \"757\", \"804\"],\n        WA: [\"206\", \"253\", \"360\", \"425\", \"509\"],\n        WV: [\"304\"],\n        WI: [\"262\", \"414\", \"534\", \"608\", \"715\", \"920\"],\n        WY: [\"307\"],\n      };\n\n      const CA_PROVINCE_AREA_CODES: Record<string, string[]> = {\n        AB: [\"403\", \"587\", \"780\", \"825\"],\n        BC: [\"236\", \"250\", \"604\", \"672\", \"778\"],\n        MB: [\"204\", \"431\"],\n        NB: [\"506\"],\n        NL: [\"709\"],\n        NS: [\"902\", \"782\"],\n        ON: [\n          \"226\",\n          \"249\",\n          \"289\",\n          \"343\",\n          \"365\",\n          \"416\",\n          \"437\",\n          \"519\",\n          \"613\",\n          \"647\",\n          \"705\",\n          \"807\",\n          \"905\",\n        ],\n        PE: [\"902\"],\n        QC: [\"226\", \"438\", \"450\", \"514\", \"579\", \"581\", \"819\", \"873\"],\n        SK: [\"306\", \"639\"],\n      };\n\n      // Build query string based on country\n      // Different countries require different search parameters\n      const query = new URLSearchParams();\n\n      // Add search criteria based on country\n      // Try multiple area codes/regions - these are commonly available\n      if (countryCode === \"US\") {\n        // For US, use state-specific area codes\n        let areaCodes: string[] = [];\n        if (state && US_STATE_AREA_CODES[state]) {\n          areaCodes = US_STATE_AREA_CODES[state];\n        } else {\n          // Fallback to general area codes\n          areaCodes = [\"415\", \"310\"];\n        }\n        // Use the specified area code index, or fallback to first one\n        const areaCode =\n          areaCodes[Math.min(areaCodeIndex, areaCodes.length - 1)];\n        query.append(\"AreaCode\", areaCode);\n      } else if (countryCode === \"CA\") {\n        // For Canada, use province-specific area codes\n        let areaCodes: string[] = [];\n        if (state && CA_PROVINCE_AREA_CODES[state]) {\n          areaCodes = CA_PROVINCE_AREA_CODES[state];\n        } else {\n          // Fallback to general area codes\n          areaCodes = [\"604\", \"416\"];\n        }\n        // Use the specified area code index, or fallback to first one\n        const areaCode =\n          areaCodes[Math.min(areaCodeIndex, areaCodes.length - 1)];\n        query.append(\"AreaCode\", areaCode);\n      } else if (countryCode === \"AU\") {\n        // For Australia, use latitude/longitude based on selected state\n        // NSW (Sydney): -33.8688, 151.2093\n        // VIC (Melbourne): -37.8136, 144.9631\n        // QLD (Brisbane): -27.4698, 153.0251\n        // WA (Perth): -31.9505, 115.8605\n        // SA (Adelaide): -34.9285, 138.6007\n        // TAS (Hobart): -42.8821, 147.3272\n        // ACT (Canberra): -35.2809, 149.1300\n        // NT (Darwin): -12.4634, 130.8456\n\n        const AU_STATE_COORDS: Record<string, { lat: string; lng: string }> = {\n          NSW: { lat: \"-33.8688\", lng: \"151.2093\" }, // Sydney\n          VIC: { lat: \"-37.8136\", lng: \"144.9631\" }, // Melbourne\n          QLD: { lat: \"-27.4698\", lng: \"153.0251\" }, // Brisbane\n          WA: { lat: \"-31.9505\", lng: \"115.8605\" }, // Perth\n          SA: { lat: \"-34.9285\", lng: \"138.6007\" }, // Adelaide\n          TAS: { lat: \"-42.8821\", lng: \"147.3272\" }, // Hobart\n          ACT: { lat: \"-35.2809\", lng: \"149.1300\" }, // Canberra\n          NT: { lat: \"-12.4634\", lng: \"130.8456\" }, // Darwin\n        };\n\n        let coords = AU_STATE_COORDS.NSW; // Default to Sydney\n        if (state && AU_STATE_COORDS[state]) {\n          coords = AU_STATE_COORDS[state];\n        }\n\n        query.append(\"NearLatLong\", `${coords.lat},${coords.lng}`);\n        // Increase distance on fallback attempts\n        query.append(\"Distance\", areaCodeIndex > 0 ? \"100\" : \"50\");\n      } else if (countryCode === \"GB\") {\n        // For UK, use latitude/longitude for London\n        query.append(\"NearLatLong\", \"51.5074,-0.1278\");\n        query.append(\"Distance\", areaCodeIndex > 0 ? \"100\" : \"50\");\n      } else if (countryCode === \"DE\") {\n        // For Germany, use latitude/longitude for Berlin\n        query.append(\"NearLatLong\", \"52.5200,13.4050\");\n        query.append(\"Distance\", areaCodeIndex > 0 ? \"100\" : \"50\");\n      } else if (countryCode === \"FR\") {\n        // For France, use latitude/longitude for Paris\n        query.append(\"NearLatLong\", \"48.8566,2.3522\");\n        query.append(\"Distance\", areaCodeIndex > 0 ? \"100\" : \"50\");\n      } else if (countryCode === \"ES\") {\n        // For Spain, use latitude/longitude for Madrid\n        query.append(\"NearLatLong\", \"40.4168,-3.7038\");\n        query.append(\"Distance\", areaCodeIndex > 0 ? \"100\" : \"50\");\n      } else {\n        // Default fallback\n        const areaCodes = [\"415\", \"310\"];\n        const areaCode =\n          areaCodes[Math.min(areaCodeIndex, areaCodes.length - 1)];\n        query.append(\"AreaCode\", areaCode);\n      }\n\n      query.append(\"Limit\", \"50\");\n\n      const options = {\n        hostname: \"api.twilio.com\",\n        path: `/2010-04-01/Accounts/${this.accountSid}/AvailablePhoneNumbers/${countryCode}/Local.json?${query.toString()}`,\n        method: \"GET\",\n        headers: {\n          Authorization: `Basic ${auth}`,\n        },\n      };\n\n      const req = https.request(options, (res) => {\n        let data = \"\";\n\n        res.on(\"data\", (chunk) => {\n          data += chunk;\n        });\n\n        res.on(\"end\", () => {\n          try {\n            const response = JSON.parse(data);\n\n            // Handle HTTP error status codes\n            if (res.statusCode && res.statusCode >= 400) {\n              return resolve({\n                error: response.code || response.message || \"Twilio API error\",\n                error_message:\n                  response.message ||\n                  `HTTP ${res.statusCode}: ${response.detail || \"Error\"}`,\n                status_code: res.statusCode,\n              });\n            }\n\n            resolve(response);\n          } catch (error) {\n            reject(error);\n          }\n        });\n      });\n\n      req.on(\"error\", (error) => {\n        reject(error);\n      });\n\n      req.end();\n    });\n  }\n\n  /**\n   * Purchase a phone number from Twilio\n   */\n  async purchasePhoneNumber(phoneNumber: string): Promise<TwilioResponse> {\n    return new Promise((resolve, reject) => {\n      const auth = Buffer.from(`${this.accountSid}:${this.authToken}`).toString(\n        \"base64\",\n      );\n\n      const postData = new URLSearchParams({\n        PhoneNumber: phoneNumber,\n      }).toString();\n\n      const options = {\n        hostname: \"api.twilio.com\",\n        path: `/2010-04-01/Accounts/${this.accountSid}/IncomingPhoneNumbers.json`,\n        method: \"POST\",\n        headers: {\n          Authorization: `Basic ${auth}`,\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n          \"Content-Length\": Buffer.byteLength(postData),\n        },\n      };\n\n      const req = https.request(options, (res) => {\n        let data = \"\";\n\n        res.on(\"data\", (chunk) => {\n          data += chunk;\n        });\n\n        res.on(\"end\", () => {\n          try {\n            const response = JSON.parse(data);\n            resolve(response);\n          } catch (error) {\n            reject(error);\n          }\n        });\n      });\n\n      req.on(\"error\", (error) => {\n        reject(error);\n      });\n\n      req.write(postData);\n      req.end();\n    });\n  }\n}\n","import { RequestHandler } from \"express\";\nimport { storage } from \"../storage\";\nimport { TwilioClient } from \"../twilio\";\nimport { AvailablePhoneNumber, PhoneNumber } from \"@shared/api\";\n\n// Country codes mapping for Twilio\nconst COUNTRY_CODES: Record<string, { code: string; name: string }> = {\n  US: { code: \"US\", name: \"United States\" },\n  CA: { code: \"CA\", name: \"Canada\" },\n  GB: { code: \"GB\", name: \"United Kingdom\" },\n  AU: { code: \"AU\", name: \"Australia\" },\n  DE: { code: \"DE\", name: \"Germany\" },\n  ES: { code: \"ES\", name: \"Spain\" },\n  FR: { code: \"FR\", name: \"France\" },\n};\n\nexport const handleGetAvailableNumbers: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const { countryCode, state } = req.query as {\n      countryCode: string;\n      state?: string;\n    };\n\n    if (!countryCode || !COUNTRY_CODES[countryCode]) {\n      return res.status(400).json({ error: \"Invalid country code\" });\n    }\n\n    // Get admin's Twilio credentials\n    const credentials = await storage.getTwilioCredentialsByAdminId(adminId);\n    if (!credentials) {\n      return res\n        .status(400)\n        .json({ error: \"Please connect your Twilio credentials first\" });\n    }\n\n    // Fetch available numbers from Twilio\n    // Try multiple area codes if the first attempt doesn't return any numbers\n    let availableNumbers: any = null;\n    let areaCodeIndex = 0;\n    const maxRetries = 5; // Try up to 5 different area codes\n\n    for (areaCodeIndex = 0; areaCodeIndex < maxRetries; areaCodeIndex++) {\n      const twilioClient = new TwilioClient(\n        credentials.accountSid,\n        credentials.authToken,\n      );\n      availableNumbers = await twilioClient.getAvailableNumbers(\n        countryCode,\n        areaCodeIndex,\n        state,\n      );\n\n      // If we got numbers or got an actual error, stop retrying\n      if (\n        availableNumbers.available_phone_numbers &&\n        availableNumbers.available_phone_numbers.length > 0\n      ) {\n        console.log(\n          `Found ${availableNumbers.available_phone_numbers.length} numbers for ${countryCode}/${state} using area code index ${areaCodeIndex}`,\n        );\n        break;\n      }\n\n      // If we got an API error, don't retry\n      if (availableNumbers.error || availableNumbers.error_message) {\n        console.warn(\n          `API error on retry ${areaCodeIndex}: ${availableNumbers.error_message}`,\n        );\n        break;\n      }\n\n      console.log(\n        `No numbers found for ${countryCode}/${state} with area code index ${areaCodeIndex}, retrying...`,\n      );\n    }\n\n    // Check for Twilio API errors\n    if (availableNumbers.error || availableNumbers.error_message) {\n      console.error(\"Twilio API error:\", availableNumbers);\n      return res.status(400).json({\n        error:\n          availableNumbers.error_message ||\n          availableNumbers.error ||\n          \"Failed to fetch numbers from Twilio\",\n      });\n    }\n\n    // Validate response structure\n    if (\n      !availableNumbers ||\n      !availableNumbers.available_phone_numbers ||\n      !Array.isArray(availableNumbers.available_phone_numbers)\n    ) {\n      console.warn(\n        \"No phone numbers available for country:\",\n        countryCode,\n        \"Response:\",\n        availableNumbers,\n      );\n      return res.json({ numbers: [] });\n    }\n\n    // Twilio returns available_phone_numbers as an array of region objects\n    // Each region object contains phone numbers\n    const allNumbers: AvailablePhoneNumber[] = [];\n\n    for (const region of availableNumbers.available_phone_numbers) {\n      // Handle both structures:\n      // 1. Direct phone numbers in the region object (newer API)\n      // 2. Nested available_phone_numbers array (older API)\n\n      const parseCapabilities = (caps: any) => {\n        if (Array.isArray(caps)) {\n          // Capabilities come as array of strings: [\"SMS\", \"Voice\", \"MMS\"]\n          return {\n            SMS: caps.includes(\"SMS\"),\n            MMS: caps.includes(\"MMS\"),\n            voice: caps.includes(\"Voice\"),\n            fax: caps.includes(\"Fax\"),\n          };\n        } else if (typeof caps === \"object\" && caps !== null) {\n          // Capabilities come as object properties\n          return {\n            SMS: caps.SMS === true,\n            MMS: caps.MMS === true,\n            voice: caps.voice === true || caps.Voice === true,\n            fax: caps.fax === true || caps.Fax === true,\n          };\n        }\n        // Default: no capabilities\n        return { SMS: false, MMS: false, voice: false, fax: false };\n      };\n\n      if (region.phone_number) {\n        // This is a direct phone number object\n        const caps = parseCapabilities(region.capabilities);\n        allNumbers.push({\n          phoneNumber: region.phone_number,\n          friendlyName: region.friendly_name || region.phone_number,\n          locality: region.locality || \"\",\n          region: region.region || \"\",\n          postalCode: region.postal_code || \"\",\n          countryCode: countryCode,\n          cost: region.price || \"1.00\",\n          capabilities: caps,\n        });\n      } else if (\n        region.available_phone_numbers &&\n        Array.isArray(region.available_phone_numbers)\n      ) {\n        // This is a region object with nested phone numbers\n        const regionNumbers = region.available_phone_numbers.map((num: any) => {\n          const caps = parseCapabilities(num.capabilities);\n          return {\n            phoneNumber: num.phone_number,\n            friendlyName: num.friendly_name || num.phone_number,\n            locality: num.locality || \"\",\n            region: num.region || \"\",\n            postalCode: num.postal_code || \"\",\n            countryCode: countryCode,\n            cost: num.price || \"1.00\",\n            capabilities: caps,\n          };\n        });\n        allNumbers.push(...regionNumbers);\n      }\n    }\n\n    if (allNumbers.length === 0) {\n      console.warn(\"No phone numbers found for country:\", countryCode);\n    }\n\n    // Filter numbers by state/province if specified\n    let filteredNumbers = allNumbers;\n    if (state) {\n      // Create a mapping of state codes to their region abbreviations\n      const STATE_REGION_MAP: Record<string, string[]> = {\n        // US states - use state abbreviation\n        AL: [\"AL\"],\n        AK: [\"AK\"],\n        AZ: [\"AZ\"],\n        AR: [\"AR\"],\n        CA: [\"CA\"],\n        CO: [\"CO\"],\n        CT: [\"CT\"],\n        DE: [\"DE\"],\n        FL: [\"FL\"],\n        GA: [\"GA\"],\n        HI: [\"HI\"],\n        ID: [\"ID\"],\n        IL: [\"IL\"],\n        IN: [\"IN\"],\n        IA: [\"IA\"],\n        KS: [\"KS\"],\n        KY: [\"KY\"],\n        LA: [\"LA\"],\n        ME: [\"ME\"],\n        MD: [\"MD\"],\n        MA: [\"MA\"],\n        MI: [\"MI\"],\n        MN: [\"MN\"],\n        MS: [\"MS\"],\n        MO: [\"MO\"],\n        MT: [\"MT\"],\n        NE: [\"NE\"],\n        NV: [\"NV\"],\n        NH: [\"NH\"],\n        NJ: [\"NJ\"],\n        NM: [\"NM\"],\n        NY: [\"NY\"],\n        NC: [\"NC\"],\n        ND: [\"ND\"],\n        OH: [\"OH\"],\n        OK: [\"OK\"],\n        OR: [\"OR\"],\n        PA: [\"PA\"],\n        RI: [\"RI\"],\n        SC: [\"SC\"],\n        SD: [\"SD\"],\n        TN: [\"TN\"],\n        TX: [\"TX\"],\n        UT: [\"UT\"],\n        VT: [\"VT\"],\n        VA: [\"VA\"],\n        WA: [\"WA\"],\n        WV: [\"WV\"],\n        WI: [\"WI\"],\n        WY: [\"WY\"],\n        // Canadian provinces\n        AB: [\"AB\", \"Alberta\"],\n        BC: [\"BC\", \"British Columbia\"],\n        MB: [\"MB\", \"Manitoba\"],\n        NB: [\"NB\", \"New Brunswick\"],\n        NL: [\"NL\", \"Newfoundland and Labrador\"],\n        NS: [\"NS\", \"Nova Scotia\"],\n        ON: [\"ON\", \"Ontario\"],\n        PE: [\"PE\", \"Prince Edward Island\"],\n        QC: [\"QC\", \"Quebec\"],\n        SK: [\"SK\", \"Saskatchewan\"],\n      };\n\n      const regionCodes = STATE_REGION_MAP[state] || [state];\n      filteredNumbers = allNumbers.filter((num) => {\n        // For countries that use state codes, filter strictly\n        if (countryCode === \"US\" || countryCode === \"CA\") {\n          const numberRegion = num.region?.toUpperCase() || \"\";\n          return regionCodes.some((code) => numberRegion.includes(code));\n        }\n        // For other countries (AU, GB, etc), return all numbers since they're already filtered by location\n        return true;\n      });\n\n      console.log(\n        `Filtered ${allNumbers.length} numbers to ${filteredNumbers.length} for state ${state}`,\n      );\n    }\n\n    res.json({ numbers: filteredNumbers });\n  } catch (error) {\n    console.error(\"Get available numbers error:\", error);\n    const errorMessage =\n      error instanceof Error\n        ? error.message\n        : \"Failed to fetch available numbers\";\n    res.status(500).json({\n      error: errorMessage,\n      details: \"Please ensure your Twilio credentials are valid\",\n    });\n  }\n};\n\nexport const handlePurchaseNumber: RequestHandler = async (req, res) => {\n  try {\n    const adminId = req.userId!;\n    const { phoneNumber, cost } = req.body as {\n      phoneNumber: string;\n      cost: number;\n    };\n\n    if (!phoneNumber || cost === undefined) {\n      return res.status(400).json({ error: \"Missing required fields\" });\n    }\n\n    // Check if number is already purchased in the system\n    const numbers = await storage.getPhoneNumbersByAdminId(adminId);\n    if (numbers.some((n) => n.phoneNumber === phoneNumber)) {\n      return res\n        .status(400)\n        .json({ error: \"This number is already purchased by you\" });\n    }\n\n    // Get wallet\n    const wallet = await storage.getOrCreateWallet(adminId);\n    if (wallet.balance < cost) {\n      return res.status(400).json({ error: \"Insufficient wallet balance\" });\n    }\n\n    // Get admin's Twilio credentials\n    const credentials = await storage.getTwilioCredentialsByAdminId(adminId);\n    if (!credentials) {\n      return res\n        .status(400)\n        .json({ error: \"Please connect your Twilio credentials first\" });\n    }\n\n    // Purchase number from Twilio\n    const twilioClient = new TwilioClient(\n      credentials.accountSid,\n      credentials.authToken,\n    );\n    const purchaseResponse =\n      await twilioClient.purchasePhoneNumber(phoneNumber);\n\n    if (purchaseResponse.error || purchaseResponse.error_message) {\n      return res.status(400).json({\n        error: purchaseResponse.error_message || purchaseResponse.error,\n      });\n    }\n\n    // Deduct from wallet\n    const newBalance = wallet.balance - cost;\n    await storage.updateWalletBalance(adminId, newBalance);\n\n    // Add transaction record\n    await storage.addWalletTransaction({\n      id: storage.generateId(),\n      adminId,\n      type: \"debit\",\n      amount: cost,\n      description: `Phone number purchased: ${phoneNumber}`,\n      reference: phoneNumber,\n      createdAt: new Date().toISOString(),\n    });\n\n    // Store phone number in database\n    const newPhoneNumber: PhoneNumber = {\n      id: storage.generateId(),\n      adminId,\n      phoneNumber,\n      purchasedAt: new Date().toISOString(),\n      active: true,\n    };\n\n    await storage.addPhoneNumber(newPhoneNumber);\n\n    res.json({ phoneNumber: newPhoneNumber, wallet: { balance: newBalance } });\n  } catch (error) {\n    console.error(\"Purchase number error:\", error);\n    res.status(500).json({ error: \"Failed to purchase number\" });\n  }\n};\n","import { RequestHandler } from \"express\";\nimport { storage } from \"../storage\";\nimport { SendMessageRequest, Message, Contact, PhoneNumber } from \"@shared/api\";\nimport { TwilioClient } from \"../twilio\";\n\nexport const handleGetAssignedPhoneNumber: RequestHandler = async (\n  req,\n  res,\n) => {\n  try {\n    const userId = req.userId!;\n    const user = await storage.getUserById(userId);\n\n    if (!user) {\n      return res.status(404).json({ error: \"User not found\" });\n    }\n\n    // Determine the admin ID\n    let adminId = userId;\n    if (user.role === \"team_member\" && user.adminId) {\n      adminId = user.adminId;\n    }\n\n    // Get phone numbers assigned to this user\n    const allPhoneNumbers = await storage.getPhoneNumbersByAdminId(adminId);\n    const assignedPhoneNumbers = allPhoneNumbers.filter(\n      (pn) => pn.assignedTo === userId,\n    );\n\n    res.json({ phoneNumbers: assignedPhoneNumbers });\n  } catch (error) {\n    console.error(\"Get assigned phone number error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleGetContacts: RequestHandler = async (req, res) => {\n  try {\n    const userId = req.userId!;\n    const { phoneNumberId } = req.query;\n\n    const user = await storage.getUserById(userId);\n\n    // Determine the admin ID\n    let adminId = userId;\n    if (user?.role === \"team_member\" && user.adminId) {\n      adminId = user.adminId;\n    }\n\n    if (!phoneNumberId) {\n      return res.status(400).json({ error: \"Phone number ID is required\" });\n    }\n\n    // Get phone number and verify access\n    const phoneNumber = await storage.getPhoneNumberById(\n      phoneNumberId as string,\n    );\n    if (!phoneNumber) {\n      return res.status(404).json({ error: \"Phone number not found\" });\n    }\n\n    // Verify user has access to this phone number\n    if (phoneNumber.adminId !== adminId) {\n      return res.status(403).json({ error: \"Unauthorized\" });\n    }\n\n    // For team members, verify they are assigned to this number\n    if (user?.role === \"team_member\" && phoneNumber.assignedTo !== userId) {\n      return res\n        .status(403)\n        .json({ error: \"This number is not assigned to you\" });\n    }\n\n    // Get contacts for this specific phone number\n    const phoneContacts = await storage.getContactsByPhoneNumber(\n      phoneNumberId as string,\n    );\n\n    // Ensure all contacts have IDs\n    const contactsWithIds = phoneContacts.map((contact) => {\n      if (!contact.id) {\n        console.warn(\"Contact missing ID:\", contact);\n        contact.id = `contact-${Math.random().toString(36).substr(2, 9)}`;\n      }\n      return contact;\n    });\n\n    console.log(\n      `Returning ${contactsWithIds.length} contacts for phone number ${phoneNumberId}`,\n    );\n    res.json({ contacts: contactsWithIds });\n  } catch (error) {\n    console.error(\"Get contacts error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleGetConversation: RequestHandler = async (req, res) => {\n  try {\n    const { contactId } = req.params;\n    console.log(\"Looking for contact with ID:\", contactId);\n\n    const contact = await storage.getContactById(contactId);\n    if (!contact) {\n      console.warn(\"Contact not found with ID:\", contactId);\n      return res.status(404).json({\n        error: \"Contact not found\",\n        contactId,\n      });\n    }\n\n    console.log(\"Found contact:\", contact.phoneNumber);\n    const messages = await storage.getMessagesByPhoneNumber(\n      contact.phoneNumberId,\n    );\n    const conversation = messages.filter(\n      (m) => m.from === contact.phoneNumber || m.to === contact.phoneNumber,\n    );\n\n    res.json({ messages: conversation });\n  } catch (error) {\n    console.error(\"Get conversation error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleSendMessage: RequestHandler = async (req, res) => {\n  try {\n    const userId = req.userId!;\n    const { to, body, phoneNumberId } = req.body as SendMessageRequest;\n\n    if (!to || !body || !phoneNumberId) {\n      return res.status(400).json({ error: \"Missing required fields\" });\n    }\n\n    // Get phone number details\n    const phoneNumber = await storage.getPhoneNumberById(phoneNumberId);\n    if (!phoneNumber) {\n      return res.status(404).json({ error: \"Phone number not found\" });\n    }\n\n    // Determine the admin ID - either the user is admin or a team member\n    const user = await storage.getUserById(userId);\n    let adminId = userId;\n    if (user?.role === \"team_member\" && user.adminId) {\n      adminId = user.adminId;\n    }\n\n    // Verify the phone number belongs to this admin\n    if (phoneNumber.adminId !== adminId) {\n      return res\n        .status(403)\n        .json({ error: \"Unauthorized to use this phone number\" });\n    }\n\n    // Get admin's Twilio credentials\n    const credentials = await storage.getTwilioCredentialsByAdminId(adminId);\n    if (!credentials) {\n      return res.status(400).json({\n        error:\n          \"Twilio credentials not connected. Please have the admin connect their credentials first.\",\n      });\n    }\n\n    // Send SMS via Twilio\n    const twilioClient = new TwilioClient(\n      credentials.accountSid,\n      credentials.authToken,\n    );\n    const twilioResponse = await twilioClient.sendSMS(\n      to,\n      phoneNumber.phoneNumber,\n      body,\n    );\n\n    if (twilioResponse.error || twilioResponse.error_message) {\n      return res\n        .status(400)\n        .json({ error: twilioResponse.error_message || twilioResponse.error });\n    }\n\n    // Store message in database\n    const message: Message = {\n      id: Math.random().toString(36).substr(2, 9),\n      phoneNumberId,\n      from: phoneNumber.phoneNumber,\n      to,\n      body,\n      direction: \"outbound\",\n      timestamp: new Date().toISOString(),\n      sid: twilioResponse.sid,\n    };\n\n    await storage.addMessage(message);\n\n    // Check if contact exists, if not create it\n    const existingContact = (\n      await storage.getContactsByPhoneNumber(phoneNumberId)\n    ).find((c) => c.phoneNumber === to);\n\n    if (!existingContact) {\n      const contact: Contact = {\n        id: Math.random().toString(36).substr(2, 9),\n        phoneNumberId,\n        phoneNumber: to,\n        unreadCount: 0,\n      };\n      await storage.addContact(contact);\n    } else {\n      // Update last message info\n      await storage.updateContact({\n        ...existingContact,\n        lastMessage: body.substring(0, 50),\n        lastMessageTime: message.timestamp,\n      });\n    }\n\n    res.json({ message });\n  } catch (error) {\n    console.error(\"Send message error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleMarkAsRead: RequestHandler = async (req, res) => {\n  try {\n    const { contactId } = req.params;\n\n    const contact = await storage.getContactById(contactId);\n    if (!contact) {\n      return res.status(404).json({ error: \"Contact not found\" });\n    }\n\n    // Update contact to mark as read\n    await storage.updateContact({\n      ...contact,\n      unreadCount: 0,\n    });\n\n    res.json({ success: true });\n  } catch (error) {\n    console.error(\"Mark as read error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleAddContact: RequestHandler = async (req, res) => {\n  try {\n    const userId = req.userId!;\n    const { name, phoneNumber, phoneNumberId } = req.body;\n\n    if (!phoneNumber || !phoneNumberId) {\n      return res\n        .status(400)\n        .json({ error: \"Phone number and phone number ID are required\" });\n    }\n\n    // Verify phone number belongs to user's admin\n    const user = await storage.getUserById(userId);\n    let adminId = userId;\n    if (user?.role === \"team_member\" && user.adminId) {\n      adminId = user.adminId;\n    }\n\n    const phoneNum = await storage.getPhoneNumberById(phoneNumberId);\n    if (!phoneNum || phoneNum.adminId !== adminId) {\n      return res.status(403).json({ error: \"Unauthorized\" });\n    }\n\n    // Check if contact already exists\n    const existingContacts =\n      await storage.getContactsByPhoneNumber(phoneNumberId);\n    if (existingContacts.some((c) => c.phoneNumber === phoneNumber)) {\n      return res.status(400).json({ error: \"Contact already exists\" });\n    }\n\n    const contact: Contact = {\n      id: Math.random().toString(36).substr(2, 9),\n      phoneNumberId,\n      phoneNumber,\n      name: name || phoneNumber,\n      unreadCount: 0,\n    };\n\n    await storage.addContact(contact);\n    res.json({ contact });\n  } catch (error) {\n    console.error(\"Add contact error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleUpdateContact: RequestHandler = async (req, res) => {\n  try {\n    const { contactId } = req.params;\n    const { name } = req.body;\n\n    const contact = await storage.getContactById(contactId);\n    if (!contact) {\n      return res.status(404).json({ error: \"Contact not found\" });\n    }\n\n    const updatedContact: Contact = {\n      ...contact,\n      ...(name && { name }),\n    };\n\n    await storage.updateContact(updatedContact);\n    res.json({ contact: updatedContact });\n  } catch (error) {\n    console.error(\"Update contact error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n\nexport const handleDeleteContact: RequestHandler = async (req, res) => {\n  try {\n    const { contactId } = req.params;\n\n    const contact = await storage.getContactById(contactId);\n    if (!contact) {\n      return res.status(404).json({ error: \"Contact not found\" });\n    }\n\n    // Delete contact from storage\n    await storage.deleteContact(contactId);\n    res.json({ success: true });\n  } catch (error) {\n    console.error(\"Delete contact error:\", error);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n};\n","import { RequestHandler } from \"express\";\nimport { storage } from \"../storage\";\nimport { Message, Contact } from \"@shared/api\";\nimport { getSocketIOInstance } from \"../index\";\n\n/**\n * Health check endpoint - verify webhook is reachable\n */\nexport const handleWebhookHealth: RequestHandler = async (req, res) => {\n  console.log(\" Webhook health check - endpoint is reachable\");\n  res.json({ status: \"ok\", timestamp: new Date().toISOString() });\n};\n\n/**\n * Handle inbound SMS from Twilio webhook\n * Receives form data from Twilio and stores the message in the database\n */\nexport const handleInboundSMS: RequestHandler = async (req, res) => {\n  console.log(\"\\n\\n ===== TWILIO WEBHOOK HIT ===== \");\n  console.log(\" Timestamp:\", new Date().toISOString());\n  console.log(\" Request Method:\", req.method);\n  console.log(\" Full request body:\", JSON.stringify(req.body, null, 2));\n  console.log(\" ===== WEBHOOK RECEIVED ===== \\n\\n\");\n\n  try {\n    const { From, To, Body, MessageSid } = req.body;\n\n    // Validate required fields\n    if (!From || !To || !Body) {\n      console.warn(\"Missing required fields in Twilio webhook:\", {\n        From,\n        To,\n        Body,\n      });\n      return res.status(400).send(\"Missing required fields\");\n    }\n\n    console.log(` Received inbound SMS from ${From} to ${To}: ${Body}`);\n\n    // Find the phone number in the database\n    const phoneNumber = await storage.getPhoneNumberByPhoneNumber(To);\n    if (!phoneNumber) {\n      console.error(` Phone number ${To} not found in database`);\n      console.error(\n        \"This means the Twilio number hasn't been added to your account\",\n      );\n      return res.status(404).send(\"Phone number not found\");\n    }\n    console.log(\n      ` Found phone number: ${phoneNumber.phoneNumber} (ID: ${phoneNumber.id})`,\n    );\n\n    // Store the message\n    const message: Message = {\n      id: MessageSid || Math.random().toString(36).substr(2, 9),\n      phoneNumberId: phoneNumber.id,\n      from: From,\n      to: To,\n      body: Body,\n      direction: \"inbound\",\n      timestamp: new Date().toISOString(),\n      sid: MessageSid,\n    };\n\n    await storage.addMessage(message);\n    console.log(` Message saved to database: ${message.id}`);\n\n    // Get or create contact\n    const contacts = await storage.getContactsByPhoneNumber(phoneNumber.id);\n    const existingContact = contacts.find((c) => c.phoneNumber === From);\n\n    let savedContact: Contact;\n    if (!existingContact) {\n      const contact: Contact = {\n        id: Math.random().toString(36).substr(2, 9),\n        phoneNumberId: phoneNumber.id,\n        phoneNumber: From,\n        lastMessage: Body.substring(0, 50),\n        lastMessageTime: message.timestamp,\n        unreadCount: 1,\n      };\n      await storage.addContact(contact);\n      savedContact = contact;\n      console.log(` New contact created: ${From}`);\n    } else {\n      // Update last message info and increment unread count\n      const updatedContact = {\n        ...existingContact,\n        lastMessage: Body.substring(0, 50),\n        lastMessageTime: message.timestamp,\n        unreadCount: (existingContact.unreadCount || 0) + 1,\n      };\n      await storage.updateContact(updatedContact);\n      savedContact = updatedContact;\n      console.log(\n        ` Contact updated: ${From}, unread count: ${(existingContact.unreadCount || 0) + 1}`,\n      );\n    }\n\n    // Emit socket.io events to notify connected clients in real-time\n    const io = getSocketIOInstance();\n    if (io && phoneNumber.assignedTo) {\n      console.log(\n        ` Emitting socket.io event to user ${phoneNumber.assignedTo}`,\n      );\n      io.to(`user:${phoneNumber.assignedTo}`).emit(\"new_message\", {\n        id: message.id,\n        phoneNumberId: phoneNumber.id,\n        from: From,\n        to: To,\n        body: Body,\n        direction: \"inbound\",\n        timestamp: message.timestamp,\n        sid: MessageSid,\n      });\n\n      // Also emit contact update event\n      io.to(`user:${phoneNumber.assignedTo}`).emit(\"contact_updated\", {\n        id: savedContact.id,\n        phoneNumberId: savedContact.phoneNumberId,\n        phoneNumber: savedContact.phoneNumber,\n        name: savedContact.name,\n        lastMessage: savedContact.lastMessage,\n        lastMessageTime: savedContact.lastMessageTime,\n        unreadCount: savedContact.unreadCount,\n      });\n    } else if (io && phoneNumber.adminId) {\n      // If no assignee, emit to admin\n      console.log(` No assignee, emitting to admin ${phoneNumber.adminId}`);\n      io.to(`admin:${phoneNumber.adminId}`).emit(\"new_message\", {\n        id: message.id,\n        phoneNumberId: phoneNumber.id,\n        from: From,\n        to: To,\n        body: Body,\n        direction: \"inbound\",\n        timestamp: message.timestamp,\n        sid: MessageSid,\n      });\n\n      io.to(`admin:${phoneNumber.adminId}`).emit(\"contact_updated\", {\n        id: savedContact.id,\n        phoneNumberId: savedContact.phoneNumberId,\n        phoneNumber: savedContact.phoneNumber,\n        name: savedContact.name,\n        lastMessage: savedContact.lastMessage,\n        lastMessageTime: savedContact.lastMessageTime,\n        unreadCount: savedContact.unreadCount,\n      });\n    } else {\n      console.warn(` No socket.io instance available or no assignee/admin`);\n    }\n\n    // Return TwiML response to Twilio\n    // This tells Twilio the webhook was received successfully\n    const twimlResponse = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Response></Response>`;\n\n    console.log(` WEBHOOK PROCESSED SUCCESSFULLY `);\n    res.type(\"application/xml\").send(twimlResponse);\n  } catch (error) {\n    console.error(\" Inbound SMS webhook error:\", error);\n    console.error(\"Error details:\", {\n      message: error instanceof Error ? error.message : String(error),\n      stack: error instanceof Error ? error.stack : undefined,\n    });\n    res.status(500).send(\"Internal server error\");\n  }\n};\n","import { RequestHandler } from \"express\";\nimport { verifyToken, extractTokenFromHeader } from \"../jwt\";\nimport { storage } from \"../storage\";\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      userId?: string;\n      userRole?: \"admin\" | \"team_member\";\n      user?: any;\n    }\n  }\n}\n\nexport const authMiddleware: RequestHandler = async (req, res, next) => {\n  try {\n    const token = extractTokenFromHeader(req.headers.authorization);\n\n    if (!token) {\n      return res.status(401).json({\n        error: \"Missing authorization token. Please login again.\",\n        code: \"NO_TOKEN\",\n      });\n    }\n\n    const payload = verifyToken(token);\n    if (!payload) {\n      return res.status(401).json({\n        error: \"Your session has expired. Please login again.\",\n        code: \"INVALID_TOKEN\",\n      });\n    }\n\n    // Get user from storage, but use token payload as fallback\n    let user;\n    try {\n      user = await storage.getUserById(payload.userId);\n    } catch (dbError) {\n      console.warn(\n        `Database lookup failed for user ${payload.userId}, using token data:`,\n        dbError,\n      );\n      // Fall through to use token data as fallback\n    }\n\n    if (!user) {\n      // If user not found in storage, create a minimal user object from token\n      // This handles the case where server restarted but token is still valid\n      user = {\n        id: payload.userId,\n        email: payload.email,\n        name: payload.email.split(\"@\")[0],\n        role: payload.role,\n        createdAt: new Date().toISOString(),\n      } as any;\n    }\n\n    req.userId = payload.userId;\n    req.userRole = payload.role;\n    req.user = user;\n\n    next();\n  } catch (error) {\n    console.error(\"Auth middleware error:\", error);\n    res.status(401).json({\n      error: \"Authentication failed. Please login again.\",\n      code: \"AUTH_ERROR\",\n    });\n  }\n};\n\nexport const adminOnly: RequestHandler = (req, res, next) => {\n  if (req.userRole !== \"admin\") {\n    return res.status(403).json({ error: \"Only admins can access this\" });\n  }\n  next();\n};\n\nexport const teamMemberOnly: RequestHandler = (req, res, next) => {\n  if (req.userRole !== \"team_member\") {\n    return res.status(403).json({ error: \"Only team members can access this\" });\n  }\n  next();\n};\n","import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import \"dotenv/config\";\nimport express, { Express } from \"express\";\nimport cors from \"cors\";\nimport { connectDB } from \"./db\";\nimport { Server as IOServer } from \"socket.io\";\n\n// Auth routes\nimport { handleSignup, handleLogin, handleGetProfile } from \"./routes/auth\";\n\n// Admin routes\nimport {\n  handleSaveCredentials,\n  handleGetCredentials,\n  handleRemoveCredentials,\n  handleGetNumbers,\n  handleSetActiveNumber,\n  handleGetTeamMembers,\n  handleInviteTeamMember,\n  handleRemoveTeamMember,\n  handleAddExistingNumber,\n  handleAssignNumber,\n  handleUpdateNumberSettings,\n  handleGetDashboardStats,\n} from \"./routes/admin\";\n\n// Wallet routes\nimport {\n  handleGetWallet,\n  handleAddFunds,\n  handleGetTransactions,\n} from \"./routes/wallet\";\n\n// Phone purchase routes\nimport {\n  handleGetAvailableNumbers,\n  handlePurchaseNumber,\n} from \"./routes/phone-purchase\";\n\n// Messages routes\nimport {\n  handleGetContacts,\n  handleGetConversation,\n  handleSendMessage,\n  handleGetAssignedPhoneNumber,\n  handleMarkAsRead,\n  handleAddContact,\n  handleUpdateContact,\n  handleDeleteContact,\n} from \"./routes/messages\";\n\n// Webhooks\nimport { handleInboundSMS, handleWebhookHealth } from \"./routes/webhooks\";\n\n// Middleware\nimport { authMiddleware, adminOnly, teamMemberOnly } from \"./middleware/auth\";\nimport { handleDemo } from \"./routes/demo\";\n\n// Global socket.io instance for webhook access\nlet globalIO: IOServer | null = null;\n\nexport function setSocketIOInstance(io: IOServer) {\n  globalIO = io;\n}\n\nexport function getSocketIOInstance(): IOServer | null {\n  return globalIO;\n}\n\nexport async function createServer() {\n  // Connect to MongoDB BEFORE creating the app\n  await connectDB();\n\n  const app = express();\n\n  // --- START: Normalize route strings to avoid path-to-regexp errors ---\n  // Convert absolute URLs like \"https://host/path\" into just \"/path\"\n  function normalizeRouteString(route: string) {\n    if (!route || typeof route !== \"string\") return route;\n    try {\n      if (route.startsWith(\"http://\") || route.startsWith(\"https://\")) {\n        const u = new URL(route);\n        return u.pathname || \"/\";\n      }\n    } catch (err) {\n      // ignore URL parsing errors and fall back to regex replace\n    }\n    // Fallback: strip origin if present\n    return route.replace(/^https?:\\/\\/[^/]+/, \"\") || \"/\";\n  }\n\n  // Patch common app methods so any string route is normalized before registration\n  const methodsToPatch = [\n    \"get\",\n    \"post\",\n    \"put\",\n    \"delete\",\n    \"patch\",\n    \"options\",\n    \"head\",\n    \"all\",\n    \"use\",\n  ] as const;\n\n  for (const method of methodsToPatch) {\n    const original = (app as any)[method].bind(app);\n    (app as any)[method] = (...args: any[]) => {\n      if (typeof args[0] === \"string\") {\n        args[0] = normalizeRouteString(args[0]);\n      } else if (Array.isArray(args[0])) {\n        args[0] = args[0].map((r: any) =>\n          typeof r === \"string\" ? normalizeRouteString(r) : r,\n        );\n      }\n      return original(...args);\n    };\n  }\n  // --- END: Normalize route strings ---\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // Public API routes\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  app.get(\"/api/demo\", handleDemo);\n\n  // Auth routes (public)\n  app.post(\"/api/auth/signup\", handleSignup);\n  app.post(\"/api/auth/login\", handleLogin);\n  app.get(\"/api/auth/profile\", authMiddleware, handleGetProfile);\n\n  // Webhook routes (public - for Twilio callbacks)\n  app.get(\"/api/webhooks/inbound-sms\", handleWebhookHealth); // Health check\n  app.post(\"/api/webhooks/inbound-sms\", handleInboundSMS);\n\n  // Admin routes (requires admin role)\n  app.post(\n    \"/api/admin/credentials\",\n    authMiddleware,\n    adminOnly,\n    handleSaveCredentials,\n  );\n  app.get(\n    \"/api/admin/credentials\",\n    authMiddleware,\n    adminOnly,\n    handleGetCredentials,\n  );\n  app.delete(\n    \"/api/admin/credentials\",\n    authMiddleware,\n    adminOnly,\n    handleRemoveCredentials,\n  );\n  app.get(\"/api/admin/numbers\", authMiddleware, adminOnly, handleGetNumbers);\n  app.post(\n    \"/api/admin/numbers/set-active\",\n    authMiddleware,\n    adminOnly,\n    handleSetActiveNumber,\n  );\n  app.post(\n    \"/api/admin/add-existing-number\",\n    authMiddleware,\n    adminOnly,\n    handleAddExistingNumber,\n  );\n  app.post(\n    \"/api/admin/assign-number\",\n    authMiddleware,\n    adminOnly,\n    handleAssignNumber,\n  );\n  app.patch(\n    \"/api/admin/number-settings\",\n    authMiddleware,\n    adminOnly,\n    handleUpdateNumberSettings,\n  );\n  app.get(\"/api/admin/team\", authMiddleware, adminOnly, handleGetTeamMembers);\n  app.post(\n    \"/api/admin/team/invite\",\n    authMiddleware,\n    adminOnly,\n    handleInviteTeamMember,\n  );\n  app.delete(\n    \"/api/admin/team/:memberId\",\n    authMiddleware,\n    adminOnly,\n    handleRemoveTeamMember,\n  );\n  app.get(\n    \"/api/admin/dashboard/stats\",\n    authMiddleware,\n    adminOnly,\n    handleGetDashboardStats,\n  );\n\n  // Messages routes (requires authentication)\n  app.get(\"/api/messages/contacts\", authMiddleware, handleGetContacts);\n  app.get(\n    \"/api/messages/conversation/:contactId\",\n    authMiddleware,\n    handleGetConversation,\n  );\n  app.post(\"/api/messages/send\", authMiddleware, handleSendMessage);\n  app.post(\n    \"/api/messages/mark-read/:contactId\",\n    authMiddleware,\n    handleMarkAsRead,\n  );\n  app.post(\"/api/contacts\", authMiddleware, handleAddContact);\n  app.patch(\"/api/contacts/:contactId\", authMiddleware, handleUpdateContact);\n  app.delete(\"/api/contacts/:contactId\", authMiddleware, handleDeleteContact);\n  app.get(\n    \"/api/messages/assigned-phone-number\",\n    authMiddleware,\n    handleGetAssignedPhoneNumber,\n  );\n\n  // Wallet routes (requires authentication)\n  app.get(\"/api/wallet\", authMiddleware, handleGetWallet);\n  app.post(\"/api/wallet/add-funds\", authMiddleware, handleAddFunds);\n  app.get(\"/api/wallet/transactions\", authMiddleware, handleGetTransactions);\n\n  // Phone purchase routes (requires authentication)\n  app.get(\n    \"/api/admin/available-numbers\",\n    authMiddleware,\n    adminOnly,\n    handleGetAvailableNumbers,\n  );\n  app.post(\n    \"/api/admin/purchase-number\",\n    authMiddleware,\n    adminOnly,\n    handlePurchaseNumber,\n  );\n\n  return app;\n}\n","/**\n * Socket.io setup for real-time messaging\n * This will handle real-time SMS notifications and updates\n */\nimport { Server as HTTPServer } from \"http\";\nimport { Server as IOServer, Socket } from \"socket.io\";\nimport { verifyToken, extractTokenFromHeader } from \"./jwt\";\nimport { storage } from \"./storage\";\n\ninterface AuthenticatedSocket extends Socket {\n  userId?: string;\n  userRole?: \"admin\" | \"team_member\";\n}\n\nexport function setupSocketIO(httpServer: HTTPServer): IOServer {\n  const io = new IOServer(httpServer, {\n    cors: {\n      origin: \"*\",\n      methods: [\"GET\", \"POST\"],\n    },\n  });\n\n  // Middleware for authentication\n  io.use((socket: AuthenticatedSocket, next) => {\n    try {\n      const token = extractTokenFromHeader(socket.handshake.auth.authorization);\n\n      if (!token) {\n        return next(new Error(\"Missing authorization token\"));\n      }\n\n      const payload = verifyToken(token);\n      if (!payload) {\n        return next(new Error(\"Invalid token\"));\n      }\n\n      socket.userId = payload.userId;\n      socket.userRole = payload.role;\n      next();\n    } catch (error) {\n      next(new Error(\"Authentication failed\"));\n    }\n  });\n\n  // Connection handlers\n  io.on(\"connection\", (socket: AuthenticatedSocket) => {\n    // Join user-specific room\n    socket.join(`user:${socket.userId}`);\n\n    if (socket.userRole === \"admin\") {\n      socket.join(`admin:${socket.userId}`);\n    }\n\n    // Handle new incoming SMS\n    socket.on(\"incoming_sms\", async (data: any) => {\n      const { phoneNumberId, from, body } = data;\n\n      try {\n        // Emit to team member assigned to this number\n        const phoneNumber = await storage.getPhoneNumberById(phoneNumberId);\n        if (phoneNumber?.assignedTo) {\n          io.to(`user:${phoneNumber.assignedTo}`).emit(\"new_message\", {\n            phoneNumberId,\n            from,\n            body,\n            direction: \"inbound\",\n            timestamp: new Date().toISOString(),\n          });\n        }\n\n        // Emit to admin\n        io.to(`admin:${phoneNumber?.adminId}`).emit(\n          \"incoming_sms_notification\",\n          {\n            phoneNumberId,\n            from,\n            preview: body.substring(0, 50),\n          },\n        );\n      } catch (error) {\n        console.error(\"Error handling incoming SMS:\", error);\n      }\n    });\n\n    // Handle message sent\n    socket.on(\"message_sent\", async (data: any) => {\n      const { phoneNumberId, to, body } = data;\n\n      try {\n        // Update all connected clients for this user\n        io.to(`user:${socket.userId}`).emit(\"message_updated\", {\n          phoneNumberId,\n          to,\n          body,\n          direction: \"outbound\",\n          timestamp: new Date().toISOString(),\n        });\n      } catch (error) {\n        console.error(\"Error handling message sent:\", error);\n      }\n    });\n\n    // Handle disconnect\n    socket.on(\"disconnect\", () => {});\n  });\n\n  return io;\n}\n\n// Export a function to emit messages from the API layer\nexport function emitNewMessage(io: IOServer, userId: string, data: any): void {\n  io.to(`user:${userId}`).emit(\"new_message\", data);\n}\n\nexport function emitIncomingSMS(\n  io: IOServer,\n  adminId: string,\n  data: any,\n): void {\n  io.to(`admin:${adminId}`).emit(\"incoming_sms_notification\", data);\n}\n","import path from \"path\";\nimport { createServer } from \"http\";\nimport {\n  createServer as createExpressServer,\n  setSocketIOInstance,\n} from \"./index\";\nimport { setupSocketIO } from \"./socket\";\nimport * as express from \"express\";\n\nasync function startServer() {\n  try {\n    const app = await createExpressServer();\n    const httpServer = createServer(app);\n    const io = setupSocketIO(httpServer);\n    setSocketIOInstance(io);\n\n    const port = process.env.PORT || 3000;\n\n    // In production, serve the built SPA files\n    const __dirname = import.meta.dirname;\n    const distPath = path.join(__dirname, \"../spa\");\n\n    // Serve static files\n    app.use(express.static(distPath));\n\n    // Handle React Router - serve index.html for all non-API routes\n    app.get(\"*\", (req, res) => {\n      // Don't serve index.html for API routes\n      if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n        return res.status(404).json({ error: \"API endpoint not found\" });\n      }\n\n      res.sendFile(path.join(distPath, \"index.html\"));\n    });\n\n    httpServer.listen(port, () => {\n      console.log(` SMSHub server running on port ${port}`);\n      console.log(` Frontend: http://localhost:${port}`);\n      console.log(` API: http://localhost:${port}/api`);\n      console.log(` WebSocket: ws://localhost:${port}`);\n    });\n\n    // Graceful shutdown\n    process.on(\"SIGTERM\", () => {\n      console.log(\" Received SIGTERM, shutting down gracefully\");\n      httpServer.close(() => {\n        process.exit(0);\n      });\n    });\n\n    process.on(\"SIGINT\", () => {\n      console.log(\" Received SIGINT, shutting down gracefully\");\n      httpServer.close(() => {\n        process.exit(0);\n      });\n    });\n  } catch (error) {\n    console.error(\"Failed to start server:\", error);\n    process.exit(1);\n  }\n}\n\nstartServer();\n"],"names":["hashPassword","express","IOServer","createExpressServer","createServer"],"mappings":"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"}